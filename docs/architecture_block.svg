<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.43.0 (0)
 -->
<!-- Title: %3 Pages: 1 -->
<svg width="984pt" height="1800pt"
 viewBox="0.00 0.00 472.10 864.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(2.02 2.02) rotate(0) translate(4 889.09)">
<title>%3</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-889.09 484,-889.09 484,4 -4,4"/>
<text text-anchor="middle" x="240" y="-868.29" font-family="Helvetica,sans-Serif" font-weight="bold" font-size="16.00">Transformer Block (Pre&#45;Norm with Cross&#45;Attention)</text>
<!-- input -->
<g id="node1" class="node">
<title>input</title>
<path fill="#fafafa" stroke="black" d="M311,-840.09C311,-840.09 168,-840.09 168,-840.09 162,-840.09 156,-834.09 156,-828.09 156,-828.09 156,-814.09 156,-814.09 156,-808.09 162,-802.09 168,-802.09 168,-802.09 311,-802.09 311,-802.09 317,-802.09 323,-808.09 323,-814.09 323,-814.09 323,-828.09 323,-828.09 323,-834.09 317,-840.09 311,-840.09"/>
<text text-anchor="middle" x="239.5" y="-824.89" font-family="Helvetica,sans-Serif" font-size="14.00">Input x</text>
<text text-anchor="middle" x="239.5" y="-809.89" font-family="Helvetica,sans-Serif" font-size="14.00">[batch, seq, d_model]</text>
</g>
<!-- norm1 -->
<g id="node2" class="node">
<title>norm1</title>
<path fill="#e1f5fe" stroke="black" d="M234.5,-765.09C234.5,-765.09 166.5,-765.09 166.5,-765.09 160.5,-765.09 154.5,-759.09 154.5,-753.09 154.5,-753.09 154.5,-741.09 154.5,-741.09 154.5,-735.09 160.5,-729.09 166.5,-729.09 166.5,-729.09 234.5,-729.09 234.5,-729.09 240.5,-729.09 246.5,-735.09 246.5,-741.09 246.5,-741.09 246.5,-753.09 246.5,-753.09 246.5,-759.09 240.5,-765.09 234.5,-765.09"/>
<text text-anchor="middle" x="200.5" y="-743.39" font-family="Helvetica,sans-Serif" font-size="14.00">LayerNorm</text>
</g>
<!-- input&#45;&gt;norm1 -->
<g id="edge1" class="edge">
<title>input&#45;&gt;norm1</title>
<path fill="none" stroke="black" d="M229.66,-801.92C225.17,-793.64 219.77,-783.66 214.84,-774.56"/>
<polygon fill="black" stroke="black" points="217.78,-772.63 209.93,-765.51 211.62,-775.97 217.78,-772.63"/>
</g>
<!-- add1 -->
<g id="node4" class="node">
<title>add1</title>
<ellipse fill="#e8f5e9" stroke="black" cx="234.5" cy="-584.24" rx="18.7" ry="18.7"/>
<text text-anchor="middle" x="234.5" y="-580.54" font-family="Helvetica,sans-Serif" font-size="14.00">+</text>
</g>
<!-- input&#45;&gt;add1 -->
<g id="edge4" class="edge">
<title>input&#45;&gt;add1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M246.04,-802.03C249.56,-791.42 253.56,-777.67 255.5,-765.09 263.97,-710.18 268.46,-694.56 257.5,-640.09 255.47,-629.98 251.52,-619.41 247.46,-610.28"/>
<polygon fill="black" stroke="black" points="250.53,-608.58 243.1,-601.02 244.2,-611.56 250.53,-608.58"/>
<text text-anchor="middle" x="293.5" y="-699.89" font-family="Times,serif" font-size="14.00">residual</text>
</g>
<!-- self_attn -->
<g id="node3" class="node">
<title>self_attn</title>
<path fill="#fff3e0" stroke="black" d="M236.5,-678.09C236.5,-678.09 148.5,-678.09 148.5,-678.09 142.5,-678.09 136.5,-672.09 136.5,-666.09 136.5,-666.09 136.5,-652.09 136.5,-652.09 136.5,-646.09 142.5,-640.09 148.5,-640.09 148.5,-640.09 236.5,-640.09 236.5,-640.09 242.5,-640.09 248.5,-646.09 248.5,-652.09 248.5,-652.09 248.5,-666.09 248.5,-666.09 248.5,-672.09 242.5,-678.09 236.5,-678.09"/>
<text text-anchor="middle" x="192.5" y="-662.89" font-family="Helvetica,sans-Serif" font-size="14.00">Self&#45;Attention</text>
<text text-anchor="middle" x="192.5" y="-647.89" font-family="Helvetica,sans-Serif" font-size="14.00">(bidirectional)</text>
</g>
<!-- norm1&#45;&gt;self_attn -->
<g id="edge2" class="edge">
<title>norm1&#45;&gt;self_attn</title>
<path fill="none" stroke="black" d="M198.88,-728.69C197.81,-717.15 196.37,-701.74 195.14,-688.45"/>
<polygon fill="black" stroke="black" points="198.61,-687.99 194.2,-678.36 191.64,-688.64 198.61,-687.99"/>
</g>
<!-- self_attn&#45;&gt;add1 -->
<g id="edge3" class="edge">
<title>self_attn&#45;&gt;add1</title>
<path fill="none" stroke="black" d="M202.88,-640.08C208.11,-631.01 214.53,-619.88 220.22,-610.02"/>
<polygon fill="black" stroke="black" points="223.42,-611.47 225.38,-601.06 217.35,-607.98 223.42,-611.47"/>
</g>
<!-- norm_cross -->
<g id="node5" class="node">
<title>norm_cross</title>
<path fill="#e1f5fe" stroke="black" d="M158.5,-527.39C158.5,-527.39 90.5,-527.39 90.5,-527.39 84.5,-527.39 78.5,-521.39 78.5,-515.39 78.5,-515.39 78.5,-503.39 78.5,-503.39 78.5,-497.39 84.5,-491.39 90.5,-491.39 90.5,-491.39 158.5,-491.39 158.5,-491.39 164.5,-491.39 170.5,-497.39 170.5,-503.39 170.5,-503.39 170.5,-515.39 170.5,-515.39 170.5,-521.39 164.5,-527.39 158.5,-527.39"/>
<text text-anchor="middle" x="124.5" y="-505.69" font-family="Helvetica,sans-Serif" font-size="14.00">LayerNorm</text>
</g>
<!-- add1&#45;&gt;norm_cross -->
<g id="edge5" class="edge">
<title>add1&#45;&gt;norm_cross</title>
<path fill="none" stroke="black" d="M219.2,-573.11C203.61,-562.78 178.88,-546.41 158.61,-532.98"/>
<polygon fill="black" stroke="black" points="160.5,-530.04 150.23,-527.43 156.63,-535.87 160.5,-530.04"/>
</g>
<!-- add2 -->
<g id="node7" class="node">
<title>add2</title>
<ellipse fill="#e8f5e9" stroke="black" cx="294.5" cy="-330.54" rx="18.7" ry="18.7"/>
<text text-anchor="middle" x="294.5" y="-326.84" font-family="Helvetica,sans-Serif" font-size="14.00">+</text>
</g>
<!-- add1&#45;&gt;add2 -->
<g id="edge9" class="edge">
<title>add1&#45;&gt;add2</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M252.42,-578.32C274.18,-571.28 309.9,-556.02 325.5,-528.39 356.54,-473.44 341.55,-447.43 325.5,-386.39 322.55,-375.17 316.72,-363.83 310.9,-354.4"/>
<polygon fill="black" stroke="black" points="313.82,-352.46 305.43,-346 307.96,-356.29 313.82,-352.46"/>
<text text-anchor="middle" x="372.5" y="-461.19" font-family="Times,serif" font-size="14.00">residual</text>
</g>
<!-- cross_attn -->
<g id="node6" class="node">
<title>cross_attn</title>
<path fill="#fff3e0" stroke="black" d="M304,-439.39C304,-439.39 185,-439.39 185,-439.39 179,-439.39 173,-433.39 173,-427.39 173,-427.39 173,-398.39 173,-398.39 173,-392.39 179,-386.39 185,-386.39 185,-386.39 304,-386.39 304,-386.39 310,-386.39 316,-392.39 316,-398.39 316,-398.39 316,-427.39 316,-427.39 316,-433.39 310,-439.39 304,-439.39"/>
<text text-anchor="middle" x="244.5" y="-424.19" font-family="Helvetica,sans-Serif" font-size="14.00">Cross&#45;Attention</text>
<text text-anchor="middle" x="244.5" y="-409.19" font-family="Helvetica,sans-Serif" font-size="14.00">(Q from decoder,</text>
<text text-anchor="middle" x="244.5" y="-394.19" font-family="Helvetica,sans-Serif" font-size="14.00">K,V from encoder)</text>
</g>
<!-- norm_cross&#45;&gt;cross_attn -->
<g id="edge6" class="edge">
<title>norm_cross&#45;&gt;cross_attn</title>
<path fill="none" stroke="black" d="M146.23,-491.28C162.31,-478.62 184.67,-461.01 204,-445.78"/>
<polygon fill="black" stroke="black" points="206.38,-448.36 212.08,-439.43 202.05,-442.86 206.38,-448.36"/>
</g>
<!-- cross_attn&#45;&gt;add2 -->
<g id="edge8" class="edge">
<title>cross_attn&#45;&gt;add2</title>
<path fill="none" stroke="black" d="M260.6,-386.03C266.65,-376.29 273.51,-365.27 279.47,-355.7"/>
<polygon fill="black" stroke="black" points="282.54,-357.39 284.85,-347.05 276.59,-353.7 282.54,-357.39"/>
</g>
<!-- norm2 -->
<g id="node9" class="node">
<title>norm2</title>
<path fill="#e1f5fe" stroke="black" d="M287.5,-274.7C287.5,-274.7 219.5,-274.7 219.5,-274.7 213.5,-274.7 207.5,-268.7 207.5,-262.7 207.5,-262.7 207.5,-250.7 207.5,-250.7 207.5,-244.7 213.5,-238.7 219.5,-238.7 219.5,-238.7 287.5,-238.7 287.5,-238.7 293.5,-238.7 299.5,-244.7 299.5,-250.7 299.5,-250.7 299.5,-262.7 299.5,-262.7 299.5,-268.7 293.5,-274.7 287.5,-274.7"/>
<text text-anchor="middle" x="253.5" y="-253" font-family="Helvetica,sans-Serif" font-size="14.00">LayerNorm</text>
</g>
<!-- add2&#45;&gt;norm2 -->
<g id="edge10" class="edge">
<title>add2&#45;&gt;norm2</title>
<path fill="none" stroke="black" d="M285.4,-313.6C280.38,-304.8 274.02,-293.66 268.3,-283.64"/>
<polygon fill="black" stroke="black" points="271.29,-281.8 263.29,-274.85 265.21,-285.27 271.29,-281.8"/>
</g>
<!-- add3 -->
<g id="node11" class="node">
<title>add3</title>
<ellipse fill="#e8f5e9" stroke="black" cx="281.5" cy="-93.85" rx="18.7" ry="18.7"/>
<text text-anchor="middle" x="281.5" y="-90.15" font-family="Helvetica,sans-Serif" font-size="14.00">+</text>
</g>
<!-- add2&#45;&gt;add3 -->
<g id="edge13" class="edge">
<title>add2&#45;&gt;add3</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M301.15,-312.81C312.99,-280.57 334.9,-207.91 317.5,-149.7 313.95,-137.83 306.93,-126.15 300.02,-116.64"/>
<polygon fill="black" stroke="black" points="302.68,-114.36 293.8,-108.57 297.13,-118.63 302.68,-114.36"/>
<text text-anchor="middle" x="352.5" y="-209.5" font-family="Times,serif" font-size="14.00">residual</text>
</g>
<!-- encoder -->
<g id="node8" class="node">
<title>encoder</title>
<path fill="#bbdefb" stroke="black" stroke-dasharray="5,2" d="M304,-528.39C304,-528.39 201,-528.39 201,-528.39 195,-528.39 189,-522.39 189,-516.39 189,-516.39 189,-502.39 189,-502.39 189,-496.39 195,-490.39 201,-490.39 201,-490.39 304,-490.39 304,-490.39 310,-490.39 316,-496.39 316,-502.39 316,-502.39 316,-516.39 316,-516.39 316,-522.39 310,-528.39 304,-528.39"/>
<text text-anchor="middle" x="252.5" y="-513.19" font-family="Helvetica,sans-Serif" font-size="14.00">Encoder Output</text>
<text text-anchor="middle" x="252.5" y="-498.19" font-family="Helvetica,sans-Serif" font-size="14.00">(CLIP features)</text>
</g>
<!-- encoder&#45;&gt;cross_attn -->
<g id="edge7" class="edge">
<title>encoder&#45;&gt;cross_attn</title>
<path fill="none" stroke="#1976d2" stroke-dasharray="5,2" d="M250.96,-490.17C249.99,-478.72 248.7,-463.55 247.54,-449.75"/>
<polygon fill="#1976d2" stroke="#1976d2" points="251,-449.23 246.67,-439.56 244.03,-449.82 251,-449.23"/>
</g>
<!-- ffn -->
<g id="node10" class="node">
<title>ffn</title>
<path fill="#f3e5f5" stroke="black" d="M296,-187.7C296,-187.7 157,-187.7 157,-187.7 151,-187.7 145,-181.7 145,-175.7 145,-175.7 145,-161.7 145,-161.7 145,-155.7 151,-149.7 157,-149.7 157,-149.7 296,-149.7 296,-149.7 302,-149.7 308,-155.7 308,-161.7 308,-161.7 308,-175.7 308,-175.7 308,-181.7 302,-187.7 296,-187.7"/>
<text text-anchor="middle" x="226.5" y="-172.5" font-family="Helvetica,sans-Serif" font-size="14.00">Feed&#45;Forward</text>
<text text-anchor="middle" x="226.5" y="-157.5" font-family="Helvetica,sans-Serif" font-size="14.00">Linear→GELU→Linear</text>
</g>
<!-- norm2&#45;&gt;ffn -->
<g id="edge11" class="edge">
<title>norm2&#45;&gt;ffn</title>
<path fill="none" stroke="black" d="M248.04,-238.29C244.38,-226.64 239.48,-211.04 235.28,-197.66"/>
<polygon fill="black" stroke="black" points="238.57,-196.46 232.24,-187.96 231.89,-198.55 238.57,-196.46"/>
</g>
<!-- ffn&#45;&gt;add3 -->
<g id="edge12" class="edge">
<title>ffn&#45;&gt;add3</title>
<path fill="none" stroke="black" d="M240.1,-149.69C247.35,-140.08 256.36,-128.14 264.12,-117.87"/>
<polygon fill="black" stroke="black" points="267.05,-119.8 270.28,-109.71 261.46,-115.58 267.05,-119.8"/>
</g>
<!-- output -->
<g id="node12" class="node">
<title>output</title>
<path fill="#fafafa" stroke="black" d="M353,-38C353,-38 210,-38 210,-38 204,-38 198,-32 198,-26 198,-26 198,-12 198,-12 198,-6 204,0 210,0 210,0 353,0 353,0 359,0 365,-6 365,-12 365,-12 365,-26 365,-26 365,-32 359,-38 353,-38"/>
<text text-anchor="middle" x="281.5" y="-22.8" font-family="Helvetica,sans-Serif" font-size="14.00">Output</text>
<text text-anchor="middle" x="281.5" y="-7.8" font-family="Helvetica,sans-Serif" font-size="14.00">[batch, seq, d_model]</text>
</g>
<!-- add3&#45;&gt;output -->
<g id="edge14" class="edge">
<title>add3&#45;&gt;output</title>
<path fill="none" stroke="black" d="M281.5,-74.84C281.5,-66.79 281.5,-57.1 281.5,-48.12"/>
<polygon fill="black" stroke="black" points="285,-48.05 281.5,-38.05 278,-48.05 285,-48.05"/>
</g>
</g>
</svg>
