<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.43.0 (0)
 -->
<!-- Title: %3 Pages: 1 -->
<svg width="1375pt" height="1633pt"
 viewBox="0.00 0.00 660.00 784.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(2.08 2.08) rotate(0) translate(4 780)">
<title>%3</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-780 656,-780 656,4 -4,4"/>
<text text-anchor="middle" x="326" y="-756" font-family="Helvetica,sans-Serif" font-weight="bold" font-size="20.00">Image Captioning: CLIP Encoder + Diffusion Decoder</text>
<g id="clust1" class="cluster">
<title>cluster_input</title>
<path fill="#fafafa" stroke="black" d="M168,-630C168,-630 518,-630 518,-630 524,-630 530,-636 530,-642 530,-642 530,-702 530,-702 530,-708 524,-714 518,-714 518,-714 168,-714 168,-714 162,-714 156,-708 156,-702 156,-702 156,-642 156,-642 156,-636 162,-630 168,-630"/>
<text text-anchor="middle" x="343" y="-694" font-family="Helvetica,sans-Serif" font-weight="bold" font-size="20.00">Input</text>
</g>
<g id="clust2" class="cluster">
<title>cluster_clip</title>
<path fill="#e3f2fd" stroke="black" d="M20,-452C20,-452 279,-452 279,-452 285,-452 291,-458 291,-464 291,-464 291,-599 291,-599 291,-605 285,-611 279,-611 279,-611 20,-611 20,-611 14,-611 8,-605 8,-599 8,-599 8,-464 8,-464 8,-458 14,-452 20,-452"/>
<text text-anchor="middle" x="149.5" y="-591" font-family="Helvetica,sans-Serif" font-weight="bold" font-size="20.00">Vision Encoder (Frozen)</text>
</g>
<g id="clust3" class="cluster">
<title>cluster_decoder</title>
<path fill="#fff8e1" stroke="black" d="M311,-215C311,-215 632,-215 632,-215 638,-215 644,-221 644,-227 644,-227 644,-599 644,-599 644,-605 638,-611 632,-611 632,-611 311,-611 311,-611 305,-611 299,-605 299,-599 299,-599 299,-227 299,-227 299,-221 305,-215 311,-215"/>
<text text-anchor="middle" x="471.5" y="-591" font-family="Helvetica,sans-Serif" font-weight="bold" font-size="20.00">Diffusion Decoder (Trainable)</text>
</g>
<g id="clust4" class="cluster">
<title>cluster_output</title>
<path fill="#fafafa" stroke="black" d="M354,-8C354,-8 510,-8 510,-8 516,-8 522,-14 522,-20 522,-20 522,-184 522,-184 522,-190 516,-196 510,-196 510,-196 354,-196 354,-196 348,-196 342,-190 342,-184 342,-184 342,-20 342,-20 342,-14 348,-8 354,-8"/>
<text text-anchor="middle" x="432" y="-176" font-family="Helvetica,sans-Serif" font-weight="bold" font-size="20.00">Output</text>
</g>
<!-- image -->
<g id="node1" class="node">
<title>image</title>
<path fill="#e8f5e9" stroke="black" d="M266,-676C266,-676 176,-676 176,-676 170,-676 164,-670 164,-664 164,-664 164,-650 164,-650 164,-644 170,-638 176,-638 176,-638 266,-638 266,-638 272,-638 278,-644 278,-650 278,-650 278,-664 278,-664 278,-670 272,-676 266,-676"/>
<text text-anchor="middle" x="221" y="-660.8" font-family="Helvetica,sans-Serif" font-size="14.00">Image</text>
<text text-anchor="middle" x="221" y="-645.8" font-family="Helvetica,sans-Serif" font-size="14.00">(224×224×3)</text>
</g>
<!-- clip -->
<g id="node4" class="node">
<title>clip</title>
<path fill="#bbdefb" stroke="black" d="M263,-573C263,-573 179,-573 179,-573 173,-573 167,-567 167,-561 167,-561 167,-547 167,-547 167,-541 173,-535 179,-535 179,-535 263,-535 263,-535 269,-535 275,-541 275,-547 275,-547 275,-561 275,-561 275,-567 269,-573 263,-573"/>
<text text-anchor="middle" x="221" y="-557.8" font-family="Helvetica,sans-Serif" font-size="14.00">CLIP ViT&#45;B/32</text>
<text text-anchor="middle" x="221" y="-542.8" font-family="Helvetica,sans-Serif" font-size="14.00">(pretrained)</text>
</g>
<!-- image&#45;&gt;clip -->
<g id="edge1" class="edge">
<title>image&#45;&gt;clip</title>
<path fill="none" stroke="black" d="M221,-637.94C221,-622.81 221,-600.94 221,-583.46"/>
<polygon fill="black" stroke="black" points="224.5,-583.24 221,-573.24 217.5,-583.24 224.5,-583.24"/>
</g>
<!-- noisy_caption -->
<g id="node2" class="node">
<title>noisy_caption</title>
<path fill="#e8f5e9" stroke="black" d="M401.5,-676C401.5,-676 308.5,-676 308.5,-676 302.5,-676 296.5,-670 296.5,-664 296.5,-664 296.5,-650 296.5,-650 296.5,-644 302.5,-638 308.5,-638 308.5,-638 401.5,-638 401.5,-638 407.5,-638 413.5,-644 413.5,-650 413.5,-650 413.5,-664 413.5,-664 413.5,-670 407.5,-676 401.5,-676"/>
<text text-anchor="middle" x="355" y="-660.8" font-family="Helvetica,sans-Serif" font-size="14.00">Noisy Caption</text>
<text text-anchor="middle" x="355" y="-645.8" font-family="Helvetica,sans-Serif" font-size="14.00">[MASK] tokens</text>
</g>
<!-- token_emb -->
<g id="node6" class="node">
<title>token_emb</title>
<path fill="#fff3e0" stroke="black" d="M391,-573C391,-573 319,-573 319,-573 313,-573 307,-567 307,-561 307,-561 307,-547 307,-547 307,-541 313,-535 319,-535 319,-535 391,-535 391,-535 397,-535 403,-541 403,-547 403,-547 403,-561 403,-561 403,-567 397,-573 391,-573"/>
<text text-anchor="middle" x="355" y="-557.8" font-family="Helvetica,sans-Serif" font-size="14.00">Token</text>
<text text-anchor="middle" x="355" y="-542.8" font-family="Helvetica,sans-Serif" font-size="14.00">Embedding</text>
</g>
<!-- noisy_caption&#45;&gt;token_emb -->
<g id="edge3" class="edge">
<title>noisy_caption&#45;&gt;token_emb</title>
<path fill="none" stroke="black" d="M355,-637.94C355,-622.81 355,-600.94 355,-583.46"/>
<polygon fill="black" stroke="black" points="358.5,-583.24 355,-573.24 351.5,-583.24 358.5,-583.24"/>
</g>
<!-- timestep -->
<g id="node3" class="node">
<title>timestep</title>
<path fill="#e8f5e9" stroke="black" d="M510,-676C510,-676 444,-676 444,-676 438,-676 432,-670 432,-664 432,-664 432,-650 432,-650 432,-644 438,-638 444,-638 444,-638 510,-638 510,-638 516,-638 522,-644 522,-650 522,-650 522,-664 522,-664 522,-670 516,-676 510,-676"/>
<text text-anchor="middle" x="477" y="-660.8" font-family="Helvetica,sans-Serif" font-size="14.00">Timestep t</text>
<text text-anchor="middle" x="477" y="-645.8" font-family="Helvetica,sans-Serif" font-size="14.00">∈ [0, 1]</text>
</g>
<!-- time_emb -->
<g id="node8" class="node">
<title>time_emb</title>
<path fill="#fff3e0" stroke="black" d="M619,-573C619,-573 547,-573 547,-573 541,-573 535,-567 535,-561 535,-561 535,-547 535,-547 535,-541 541,-535 547,-535 547,-535 619,-535 619,-535 625,-535 631,-541 631,-547 631,-547 631,-561 631,-561 631,-567 625,-573 619,-573"/>
<text text-anchor="middle" x="583" y="-557.8" font-family="Helvetica,sans-Serif" font-size="14.00">Timestep</text>
<text text-anchor="middle" x="583" y="-542.8" font-family="Helvetica,sans-Serif" font-size="14.00">Embedding</text>
</g>
<!-- timestep&#45;&gt;time_emb -->
<g id="edge6" class="edge">
<title>timestep&#45;&gt;time_emb</title>
<path fill="none" stroke="black" d="M497.17,-637.76C506.07,-629.64 516.62,-619.91 526,-611 536.5,-601.03 547.91,-589.87 557.75,-580.16"/>
<polygon fill="black" stroke="black" points="560.28,-582.59 564.93,-573.06 555.36,-577.61 560.28,-582.59"/>
</g>
<!-- clip_features -->
<g id="node5" class="node">
<title>clip_features</title>
<path fill="#bbdefb" stroke="black" d="M271,-498C271,-498 171,-498 171,-498 165,-498 159,-492 159,-486 159,-486 159,-472 159,-472 159,-466 165,-460 171,-460 171,-460 271,-460 271,-460 277,-460 283,-466 283,-472 283,-472 283,-486 283,-486 283,-492 277,-498 271,-498"/>
<text text-anchor="middle" x="221" y="-482.8" font-family="Helvetica,sans-Serif" font-size="14.00">Image Features</text>
<text text-anchor="middle" x="221" y="-467.8" font-family="Helvetica,sans-Serif" font-size="14.00">[50, 768]</text>
</g>
<!-- clip&#45;&gt;clip_features -->
<g id="edge2" class="edge">
<title>clip&#45;&gt;clip_features</title>
<path fill="none" stroke="black" d="M221,-534.96C221,-526.88 221,-517.18 221,-508.18"/>
<polygon fill="black" stroke="black" points="224.5,-508.09 221,-498.09 217.5,-508.09 224.5,-508.09"/>
</g>
<!-- blocks -->
<g id="node10" class="node">
<title>blocks</title>
<polygon fill="#fff3e0" stroke="black" points="545,-409 323,-409 319,-405 319,-371 541,-371 545,-375 545,-409"/>
<polyline fill="none" stroke="black" points="541,-405 319,-405 "/>
<polyline fill="none" stroke="black" points="541,-405 541,-371 "/>
<polyline fill="none" stroke="black" points="541,-405 545,-409 "/>
<text text-anchor="middle" x="432" y="-393.8" font-family="Helvetica,sans-Serif" font-size="14.00">Transformer Blocks ×6</text>
<text text-anchor="middle" x="432" y="-378.8" font-family="Helvetica,sans-Serif" font-size="14.00">(Self&#45;Attn + Cross&#45;Attn + FFN)</text>
</g>
<!-- clip_features&#45;&gt;blocks -->
<g id="edge9" class="edge">
<title>clip_features&#45;&gt;blocks</title>
<path fill="none" stroke="#1976d2" stroke-dasharray="5,2" d="M258.78,-459.9C280.34,-449.8 307.98,-437.23 333,-427 345.07,-422.06 358.1,-417.09 370.62,-412.47"/>
<polygon fill="#1976d2" stroke="#1976d2" points="371.88,-415.74 380.07,-409.02 369.47,-409.16 371.88,-415.74"/>
<text text-anchor="middle" x="387" y="-430.8" font-family="Times,serif" font-size="14.00">cross&#45;attention</text>
</g>
<!-- add_emb -->
<g id="node9" class="node">
<title>add_emb</title>
<ellipse fill="#fffde7" stroke="black" cx="462" cy="-479" rx="18.7" ry="18.7"/>
<text text-anchor="middle" x="462" y="-475.3" font-family="Helvetica,sans-Serif" font-size="14.00">+</text>
</g>
<!-- token_emb&#45;&gt;add_emb -->
<g id="edge4" class="edge">
<title>token_emb&#45;&gt;add_emb</title>
<path fill="none" stroke="black" d="M381.45,-534.96C398.79,-523.13 421.26,-507.79 438.07,-496.33"/>
<polygon fill="black" stroke="black" points="440.46,-498.93 446.75,-490.4 436.52,-493.15 440.46,-498.93"/>
</g>
<!-- pos_emb -->
<g id="node7" class="node">
<title>pos_emb</title>
<path fill="#fff3e0" stroke="black" d="M505,-573C505,-573 433,-573 433,-573 427,-573 421,-567 421,-561 421,-561 421,-547 421,-547 421,-541 427,-535 433,-535 433,-535 505,-535 505,-535 511,-535 517,-541 517,-547 517,-547 517,-561 517,-561 517,-567 511,-573 505,-573"/>
<text text-anchor="middle" x="469" y="-557.8" font-family="Helvetica,sans-Serif" font-size="14.00">Position</text>
<text text-anchor="middle" x="469" y="-542.8" font-family="Helvetica,sans-Serif" font-size="14.00">Embedding</text>
</g>
<!-- pos_emb&#45;&gt;add_emb -->
<g id="edge5" class="edge">
<title>pos_emb&#45;&gt;add_emb</title>
<path fill="none" stroke="black" d="M467.27,-534.96C466.49,-526.82 465.55,-517.03 464.68,-507.98"/>
<polygon fill="black" stroke="black" points="468.15,-507.46 463.71,-497.84 461.18,-508.13 468.15,-507.46"/>
</g>
<!-- time_emb&#45;&gt;add_emb -->
<g id="edge7" class="edge">
<title>time_emb&#45;&gt;add_emb</title>
<path fill="none" stroke="black" d="M553.09,-534.96C532.64,-522.62 505.87,-506.46 486.65,-494.87"/>
<polygon fill="black" stroke="black" points="488.25,-491.75 477.88,-489.58 484.63,-497.74 488.25,-491.75"/>
</g>
<!-- add_emb&#45;&gt;blocks -->
<g id="edge8" class="edge">
<title>add_emb&#45;&gt;blocks</title>
<path fill="none" stroke="black" d="M456.07,-460.81C451.92,-448.78 446.29,-432.44 441.52,-418.59"/>
<polygon fill="black" stroke="black" points="444.79,-417.36 438.22,-409.05 438.18,-419.65 444.79,-417.36"/>
</g>
<!-- norm -->
<g id="node11" class="node">
<title>norm</title>
<path fill="#fff3e0" stroke="black" d="M466,-334C466,-334 398,-334 398,-334 392,-334 386,-328 386,-322 386,-322 386,-310 386,-310 386,-304 392,-298 398,-298 398,-298 466,-298 466,-298 472,-298 478,-304 478,-310 478,-310 478,-322 478,-322 478,-328 472,-334 466,-334"/>
<text text-anchor="middle" x="432" y="-312.3" font-family="Helvetica,sans-Serif" font-size="14.00">LayerNorm</text>
</g>
<!-- blocks&#45;&gt;norm -->
<g id="edge10" class="edge">
<title>blocks&#45;&gt;norm</title>
<path fill="none" stroke="black" d="M432,-370.83C432,-362.89 432,-353.41 432,-344.63"/>
<polygon fill="black" stroke="black" points="435.5,-344.42 432,-334.42 428.5,-344.42 435.5,-344.42"/>
</g>
<!-- proj -->
<g id="node12" class="node">
<title>proj</title>
<path fill="#fff3e0" stroke="black" d="M488.5,-261C488.5,-261 375.5,-261 375.5,-261 369.5,-261 363.5,-255 363.5,-249 363.5,-249 363.5,-235 363.5,-235 363.5,-229 369.5,-223 375.5,-223 375.5,-223 488.5,-223 488.5,-223 494.5,-223 500.5,-229 500.5,-235 500.5,-235 500.5,-249 500.5,-249 500.5,-255 494.5,-261 488.5,-261"/>
<text text-anchor="middle" x="432" y="-245.8" font-family="Helvetica,sans-Serif" font-size="14.00">Output Projection</text>
<text text-anchor="middle" x="432" y="-230.8" font-family="Helvetica,sans-Serif" font-size="14.00">→ vocab logits</text>
</g>
<!-- norm&#45;&gt;proj -->
<g id="edge11" class="edge">
<title>norm&#45;&gt;proj</title>
<path fill="none" stroke="black" d="M432,-297.94C432,-289.99 432,-280.31 432,-271.31"/>
<polygon fill="black" stroke="black" points="435.5,-271.2 432,-261.2 428.5,-271.2 435.5,-271.2"/>
</g>
<!-- logits -->
<g id="node13" class="node">
<title>logits</title>
<path fill="#f3e5f5" stroke="black" d="M502,-158C502,-158 362,-158 362,-158 356,-158 350,-152 350,-146 350,-146 350,-132 350,-132 350,-126 356,-120 362,-120 362,-120 502,-120 502,-120 508,-120 514,-126 514,-132 514,-132 514,-146 514,-146 514,-152 508,-158 502,-158"/>
<text text-anchor="middle" x="432" y="-142.8" font-family="Helvetica,sans-Serif" font-size="14.00">Logits</text>
<text text-anchor="middle" x="432" y="-127.8" font-family="Helvetica,sans-Serif" font-size="14.00">[seq_len, vocab_size]</text>
</g>
<!-- proj&#45;&gt;logits -->
<g id="edge12" class="edge">
<title>proj&#45;&gt;logits</title>
<path fill="none" stroke="black" d="M432,-222.94C432,-207.81 432,-185.94 432,-168.46"/>
<polygon fill="black" stroke="black" points="435.5,-168.24 432,-158.24 428.5,-168.24 435.5,-168.24"/>
</g>
<!-- caption -->
<g id="node14" class="node">
<title>caption</title>
<path fill="#f3e5f5" stroke="black" d="M500,-54C500,-54 364,-54 364,-54 358,-54 352,-48 352,-42 352,-42 352,-28 352,-28 352,-22 358,-16 364,-16 364,-16 500,-16 500,-16 506,-16 512,-22 512,-28 512,-28 512,-42 512,-42 512,-48 506,-54 500,-54"/>
<text text-anchor="middle" x="432" y="-38.8" font-family="Helvetica,sans-Serif" font-size="14.00">Generated Caption</text>
<text text-anchor="middle" x="432" y="-23.8" font-family="Helvetica,sans-Serif" font-size="14.00">&quot;A small red square&quot;</text>
</g>
<!-- logits&#45;&gt;caption -->
<g id="edge13" class="edge">
<title>logits&#45;&gt;caption</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M432,-119.76C432,-104.32 432,-81.91 432,-64.16"/>
<polygon fill="black" stroke="black" points="435.5,-64.08 432,-54.08 428.5,-64.08 435.5,-64.08"/>
<text text-anchor="middle" x="467" y="-90.8" font-family="Times,serif" font-size="14.00">iterative</text>
<text text-anchor="middle" x="467" y="-75.8" font-family="Times,serif" font-size="14.00">denoising</text>
</g>
</g>
</svg>
